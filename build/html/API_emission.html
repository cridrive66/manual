

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Emission &mdash; APRIORA plugin manual  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=1f9ce7ab" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="Troubleshooting.html" />
    <link rel="prev" title="Flow Estimation" href="Flow_Estimation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            APRIORA plugin manual
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation for Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="Flow_Estimation.html">Flow Estimation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Emission</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#consumption-selection">Consumption Selection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-data">Input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workflow">Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#emission-loads">Emission Loads</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#accumulation">Accumulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#risk-assessment">Risk Assessment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">Input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dummy-data">Dummy data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">APRIORA plugin manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">API Emission</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/API_emission.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api-emission">
<span id="id1"></span><h1>API Emission<a class="headerlink" href="#api-emission" title="Link to this heading"></a></h1>
<p>The <em>API Emission</em> provides a set of tools where the user can calculate the load of certain APIs at different WWTPs and
perform the risk assessment in each river section within a catchment.</p>
<p>This group of tools is divided in 4 different processes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#consumption-selection"><span class="std std-ref">Consumption Selection</span></a></p></li>
<li><p><a class="reference internal" href="#emission-loads"><span class="std std-ref">Emission Loads</span></a></p></li>
<li><p><a class="reference internal" href="#accumulation"><span class="std std-ref">Accumulation</span></a></p></li>
<li><p><a class="reference internal" href="#risk-assessment"><span class="std std-ref">Risk Assessment</span></a></p></li>
</ul>
<section id="consumption-selection">
<span id="id2"></span><h2>Consumption Selection<a class="headerlink" href="#consumption-selection" title="Link to this heading"></a></h2>
<p>This tool is giving the user the access to the APRIORA’s internal database related to consumption data, removal rates and PNEC values.
Since it is not a processing tool, the user cannot find it under the <em>Processing Toolbox</em>. It is displayed instead under <em>Plugins</em> –&gt; <em>Consumption Selection</em> or
in the Menu Toolbar (<a class="reference internal" href="#consumption-selection-fig"><span class="std std-numref">Fig. 1</span></a>).</p>
<figure class="align-default" id="id22">
<span id="consumption-selection-fig"></span><a class="reference internal image-reference" href="_images/consumption_selection.png"><img alt="_images/consumption_selection.png" src="_images/consumption_selection.png" style="width: 500px; height: 200px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Location of the <em>Consumption Selection</em> tool in the Menu Toolbar.</span><a class="headerlink" href="#id22" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The tool contains 4 different windows:</p>
<ul class="simple">
<li><p>Consumption data</p></li>
<li><p>Removal rate</p></li>
<li><p>Custom table</p></li>
<li><p>PNEC values</p></li>
</ul>
<p>In the next paragraphs, the functionalities of each windows are described. More detailed instruction on how to use them can be found in the video-tutorial
in the <strong>Workflow</strong> section below.</p>
<div class="line-block">
<div class="line"><strong>Consumption data</strong></div>
<div class="line">Here the user can explore the consumption data related to several substances, with different spatial and temporal coverage (<a class="reference internal" href="#consumption-interface-fig"><span class="std std-numref">Fig. 2</span></a>). The consumption data is expressed in
<em>mg/inh./a</em> and it is already including the excretion rate from the human body. When a regional coverage is not available, it is marked as “-” and the national
value is considered instead. The consumption values are calculated with the formula <a class="reference internal" href="#equation-consumption-equation">(1)</a>.</div>
</div>
<div class="math notranslate nohighlight" id="equation-consumption-equation">
<span class="eqno">(1)<a class="headerlink" href="#equation-consumption-equation" title="Link to this equation"></a></span>\[m_{i,y} = ((m_{cp,y} + m_{cs,y}) \cdot e)/n_{pop}\]</div>
<p>With:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(m_{i,y}\)</span> = yearly consumption of y API [<span class="math notranslate nohighlight">\(mg/inh/a\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(m_{cp,y}\)</span> = yearly prescribed API intake [<span class="math notranslate nohighlight">\(kg/a\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(m_{cs,y}\)</span> = yearly sold over-the-counter API intake [<span class="math notranslate nohighlight">\(kg/a\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(e\)</span> = API specific excretion rate [-]</p></li>
<li><p><span class="math notranslate nohighlight">\(n_{pop}\)</span> = population in the reference area for intake data  [-]</p></li>
</ul>
<div class="line-block">
<div class="line">In case the user would like to add a new substance in the database or the same substance but with a different coverage, it is possible to
do it by clicking on the “+” icon. A new row is added at the bottom of the table and the user should fill out the cells with important information like: API input, API name,
year, country and region. The other fields can be kept empty. In case a wrongful substance is added, it is possible to select it and then remove it with the “-” icon. When
all the changes have been applied, click on the save icon. If the user would like to go back to the core table, simply click on “Restore original”.</div>
</div>
<figure class="align-default" id="id23">
<span id="consumption-interface-fig"></span><img alt="_images/consumption_interface.png" src="_images/consumption_interface.png" />
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Interface of the “Consumption data” window within the Consumption Selection tool.</span><a class="headerlink" href="#id23" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><strong>Removal rate</strong></div>
<div class="line">This window (<a class="reference internal" href="#removal-interface-fig"><span class="std std-numref">Fig. 3</span></a>) contains a table with the removal rates of different APIs for the 4 different types of treatment: TC1 (primary treatment), screening and sedimentation; TC2
(secondary treatment), aeration and bacterial digestion; TC3 (tertiary treatment), nutrient removal, filtration and chlorine/UV; TC4 (quaternary treatment), activated
carbon and reverse osmosis. This table provides cumulative removal rates for each treatment stage. This means the value for a given stage (e.g., TC3) already includes
the combined removal efficiency of all previous stages (TC1 and TC2). Therefore the calculation is direct and not sequential.</div>
<div class="line">With a similar logic like before, the user can add a new substance (or edit the current value) by clicking on the “+” icon. After making a change, remember to click
on the save icon.</div>
</div>
<figure class="align-default" id="id24">
<span id="removal-interface-fig"></span><img alt="_images/removal_interface.png" src="_images/removal_interface.png" />
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Interface of the “Removal rate” window within the Consumption Selection tool.</span><a class="headerlink" href="#id24" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><strong>Custom table</strong></div>
<div class="line">In case the user would like to further customize the input data like consumption and removal rates at a more detailed level, here it is possible to do it (<a class="reference internal" href="#custom-table-interface-fig"><span class="std std-numref">Fig. 4</span></a>).
By selecting the WWTPs shapefile and the correct fields for ID, name and technical class, it is possible to display the consumption values and removal rates for each WWTPs included in the
shapefile. By doing so, the user can edit a consumption values or a removal rate for that specific WWTP. After doing any edit, click on the <em>Save</em> button.</div>
</div>
<figure class="align-default" id="id25">
<span id="custom-table-interface-fig"></span><img alt="_images/custom_table_interface.png" src="_images/custom_table_interface.png" />
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Interface of the “Custom table” window within the Consumption Selection tool.</span><a class="headerlink" href="#id25" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><strong>PNEC values</strong></div>
<div class="line">This window (<a class="reference internal" href="#pnec-interface-fig"><span class="std std-numref">Fig. 5</span></a>) contains a table with the PNEC values of different APIs expressed in ng/L. With a similar logic like before, the user can add a new substance
(or edit the current value) by clicking on the “+” icon. After making a change, remember to click on the save icon.
As mere information, limit of quantification (LOQ) of two different laboratories are included: Kristianstad University (Sweden) and SYKE (Finland).</div>
</div>
<figure class="align-default" id="id26">
<span id="pnec-interface-fig"></span><img alt="_images/PNEC_interface.png" src="_images/PNEC_interface.png" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Interface of the “PNEC values” window within the Consumption Selection tool.</span><a class="headerlink" href="#id26" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="input-data">
<h3>Input data<a class="headerlink" href="#input-data" title="Link to this heading"></a></h3>
<p>For this tool no input data is required. All the necessary input data (e.g., consumption values, removal rates, PNEC values) are already provided. If the user would like
to add their own input data, it is possible to do so as previously described. In case the user would like to change consumption values and removal rates at the WWTPs emission
points, it is necessary to add in the QGIS project a shapefile containing emission points of WWTPs with fields dedicated to id, WWTP name, connected inhabitants and
technical class (number from 1 to 4).</p>
<p>(write something in case the user has a table that wants to integrate)</p>
</section>
<section id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Link to this heading"></a></h3>
<p><strong>Consumption data</strong></p>
<ol class="arabic simple">
<li><p>Click on the <em>Consumption Selection</em> icon in the menu toolbar or go under <em>Plugins</em> –&gt; <em>Consumption Selection</em></p></li>
<li><p>Go on the “Consumption data” window</p></li>
<li><p>Explore the database and find the APIs that you are interested in (e.g., Carbamazepine and Diclofenac for 2023, Germany, MV)</p></li>
<li><p>Select the substances by filling out correctly the “API name”, “Year”, “Country” and “Region” fields</p></li>
<li><p>Click on “Add to the selection” and the substance will be added in the “Selected consumption data” window</p></li>
<li><p>Repeat the steps 3 - 5 with all the interested APIs</p></li>
<li><p>Click on “Save selection”</p></li>
</ol>
<p>In case the user would like to add custom substances:</p>
<ol class="arabic simple" start="8">
<li><p>Click on the “+” icon</p></li>
<li><p>Go to the bottom of the table and fill out the “API input”, “API name”, “year”, “country” and “region” fields. The other fields can be kept empty.</p></li>
<li><p>Click on the save icon</p></li>
<li><p>Add to the selection the newly added API by repeating the steps 3 - 5.</p></li>
<li><p>Click on “Save selection”</p></li>
</ol>
<figure>
  <video width="700" height="370" controls>
    <source src="_static/Consumption_selection_1.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <figcaption>Worflow of <i>Consumption data</i> window within <i>Consumption Selection</i> tool.</figcaption>
</figure><p><strong>Removal rate</strong></p>
<ol class="arabic simple">
<li><p>Go on the “Removal rate” window</p></li>
<li><p>Check if the values for the different APIs and different technical classes are correct</p></li>
<li><p>In case you would like to change something, simply double click on a number and update the value</p></li>
<li><p>In case you would like to add a new substance, click on the “+” icon and fill out all the fields (“CAS No.” can be kept empty)</p></li>
<li><p>After all the edits, click on the save icon</p></li>
</ol>
<figure>
  <video width="700" height="370" controls>
    <source src="_static/removal_rate.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <figcaption>Worflow of <i>Removal rate</i> window within <i>Consumption Selection</i> tool.</figcaption>
</figure><p><strong>Custom table</strong></p>
<ol class="arabic simple">
<li><p>Go on the “Custom table” window</p></li>
<li><p>Select the WWTP shapefile and specify the field for ID, name and technical class. In case you cannot find the shapefile between the available ones, click on the reload button.</p></li>
<li><p>Click on “Load Table”</p></li>
<li><p>Check the consumption values and removal rates at each WWTPs. In case you would like to change something, double click on a number and update the value.</p></li>
<li><p>After all the edits, click on “Save”</p></li>
</ol>
<figure>
  <video width="700" height="370" controls>
    <source src="_static/custom_table.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <figcaption>Worflow of <i>Custom table</i> window within <i>Consumption Selection</i> tool.</figcaption>
</figure><p><strong>PNEC values</strong></p>
<ol class="arabic simple">
<li><p>Go on the “PNEC values” window</p></li>
<li><p>Check if the values for the different APIs are correct</p></li>
<li><p>In case you would like to change something, simply double click on a number and update the value</p></li>
<li><p>In case you would like to add a new substance, click on the “+” icon and fill out the “PNEC” field (“LOQ” fields can be kept empty)</p></li>
<li><p>After all the edits, click on the save icon</p></li>
</ol>
<figure>
  <video width="700" height="370" controls>
    <source src="_static/PNEC.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <figcaption>Worflow of <i>PNEC values</i> window within <i>Consumption Selection</i> tool.</figcaption>
</figure></section>
</section>
<section id="emission-loads">
<span id="id3"></span><h2>Emission Loads<a class="headerlink" href="#emission-loads" title="Link to this heading"></a></h2>
<p>This tool calculates the load of previously selected APIs at each WWTP within a catchmment.
The load is calculated according to the formula <a class="reference internal" href="#equation-load-equation">(2)</a>:</p>
<div class="math notranslate nohighlight" id="equation-load-equation">
<span class="eqno">(2)<a class="headerlink" href="#equation-load-equation" title="Link to this equation"></a></span>\[m_{WW,eff} = i_{WWTP} \cdot m_{i,y} \cdot (1 - r_{WWTP}) / 1000\]</div>
<p>With:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(m_{WW,eff}\)</span> = load [<span class="math notranslate nohighlight">\(kg/a\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(i_{WWTP}\)</span> = connected inhabitants [<span class="math notranslate nohighlight">\(inh\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(m_{i,y}\)</span> = yearly consumption of y API [<span class="math notranslate nohighlight">\(mg/inh/a\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(r_{WWTP}\)</span> = removal rate  [-]</p></li>
</ul>
<p>The plugin retrieves the technical class assigned to each treatmant plant and identifies the corresponding removal rate for each API
from the data pool. This value (<span class="math notranslate nohighlight">\(r_{WWTP}\)</span>) is then used as input for formula <a class="reference internal" href="#equation-load-equation">(2)</a> to calculate the
reduced emissions after treatment.</p>
<section id="id4">
<h3>Input data<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>One input data is necessary for this tool:</p>
<ul class="simple">
<li><p><strong>WWTP.shp</strong></p></li>
</ul>
<p>The <strong>WWTP.shp</strong> is a point shapefile containing the emission point of the WWTPs as geometry and important information of the facilities in the attribute table. The required
information are: ID and name of the WWTP; number of connected inhabitant; number representing the type of treatment (1=primary, 2=secondary, 3=tertiary, 4=quaternary). An
example of these information can be summarized by <a class="reference internal" href="#wwtp-attribute-table"><span class="std std-numref">Table 2</span></a>.</p>
<span id="wwtp-attribute-table"></span><table class="docutils align-default" id="id27">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Example of attribute table with required data for WWTPs.</span><a class="headerlink" href="#id27" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 17.6%" />
<col style="width: 35.3%" />
<col style="width: 23.5%" />
<col style="width: 23.5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ID</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Connected Inhabitants</p></th>
<th class="head"><p>Type of treatment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>163</p></td>
<td><p>KA Vorbeck</p></td>
<td><p>98</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>202</p></td>
<td><p>KA Groß Lüsewitz</p></td>
<td><p>913</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>691</p></td>
<td><p>KA Schwaan</p></td>
<td><p>10004</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>156</p></td>
<td><p>KA Hanstorf</p></td>
<td><p>312</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>169</p></td>
<td><p>KA Güstrow/Parum</p></td>
<td><p>34333</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The column “Type of treatment” needs to be a number from 1 to 4.
The emission point should be within 500 m to the closest river section.</p>
</div>
</section>
<section id="id5">
<h3>Workflow<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Add the input data to the project by clicking on “Layer -&gt; Add Layer -&gt; Add Vector Layer”</p></li>
<li><p>Go in the Processing Toolbox and look for the <em>APRIORA</em> plugin. Click on <em>API emission</em> and open <em>5 - Emission Loads</em></p></li>
<li><p>Choose <strong>WWTP.shp</strong> as input for <em>Emission Points of WWTP</em></p></li>
<li><p>Select the correct field of <strong>WWTP.shp</strong> for <em>ID</em>, <em>Name</em>, <em>Connected Inhabitants</em> and <em>Technology Class</em></p></li>
<li><p>If you created a custom table from the <em>Consumption Selection</em> tool, flag the next box, otherwise leave it empty</p></li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Under <em>Current API Selection</em> you can see the substances previously selected. This window is only displaying the selection, if you want
to change the selection go back to <a class="reference internal" href="#consumption-selection"><span class="std std-ref">Consumption Selection</span></a>.</p>
</div>
<ol class="arabic simple" start="6">
<li><p>Click on <em>Run</em></p></li>
</ol>
<figure>
  <video width="700" height="370" controls>
    <source src="_static/Emission_load_1.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <figcaption>Worflow of the <i>Emission Loads</i> tool.</figcaption>
</figure><p>Output data:</p>
<ul class="simple">
<li><p><strong>emission_loads.shp</strong></p></li>
</ul>
<p>The output is a point shapefile with the same geometry as the <strong>WWTP.shp</strong>. The attribute table contains the <em>ID</em> and <em>Name</em> columns from <strong>WWTP.shp</strong> and
<em>n</em> columns related to the emission load of <em>n</em> selected APIs (e.g., if the user selects 3 APIs, 3 load columns are added). Finally, the load is expressed in <em>kg/a</em>.</p>
</section>
</section>
<section id="accumulation">
<span id="id6"></span><h2>Accumulation<a class="headerlink" href="#accumulation" title="Link to this heading"></a></h2>
<div class="line-block">
<div class="line">This tool combine the output of <a class="reference internal" href="Flow_Estimation.html#flow-estimation-tool"><span class="std std-ref">Flow Estimation</span></a> with the output of <a class="reference internal" href="#emission-loads"><span class="std std-ref">Emission Loads</span></a>. In this part, the load of the selected APIs is transferred to
the river network and the concentration for <em>mean flow</em> and <em>mean low flow</em> condition is calculated.</div>
<div class="line">In the first step, each emission point is projected onto the closest river section, where a new sub-section is created to integrate the WWTP discharge.
In the example shown in <a class="reference internal" href="#accumulation-division-fig"><span class="std std-numref">Fig. 6</span></a>, three river sections and one WWTP are considered. The emission point is connected to river section 2, which is then divided into 2A
and 2B. Because flow direction is from section 1 toward section 3, the load is transferred downstream to 2B and 3, while sections 1 and 2A remain unaffected by API inputs.
From section 2B onward then, the emitted load is accumulated along the river network.</div>
<div class="line">After splitting, the mean flow and mean low flow of section 2 (the affected section) is proportionally redistributed between 2A and 2B (the new sub-sections) according to
their relative lengths.</div>
</div>
<figure class="align-default" id="id28">
<span id="accumulation-division-fig"></span><img alt="_images/accumulation_division.png" src="_images/accumulation_division.png" />
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">How the division in extra river sections at WWTPs works within the plugin.</span><a class="headerlink" href="#id28" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Once all WWTP emission points have been processed this way, API loads are progressively accumulated downstream along the network. Based on these accumulated loads and the
flow values stored in the river shapefile, API concentrations are then calculated for each river section with formula <a class="reference internal" href="#equation-accumulation-equation">(3)</a>.
Two values are derived: concentration under mean flow conditions and concentration under mean low flow conditions.</p>
<div class="math notranslate nohighlight" id="equation-accumulation-equation">
<span class="eqno">(3)<a class="headerlink" href="#equation-accumulation-equation" title="Link to this equation"></a></span>\[PEC = \frac{\sum (m_{WW,eff})_{up}}{Q} \cdot k\]</div>
<p>With:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(PEC\)</span> = Predicted Environmental Concentration [<span class="math notranslate nohighlight">\(ng/L\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\((m_{WW,eff})_{up}\)</span> = load from all the upstream river section [<span class="math notranslate nohighlight">\(kg/a\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(Q\)</span> = mean flow or mean low flow [<span class="math notranslate nohighlight">\(m^3\!/s\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span> = conversion factor [<span class="math notranslate nohighlight">\(\frac{ng/kg \cdot m^3\!/L}{s/a}\)</span>]</p></li>
</ul>
<section id="id7">
<h3>Input data<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>Two input data are required for this tool:</p>
<ul class="simple">
<li><p><strong>emission_loads.shp</strong></p></li>
<li><p><strong>river_level.shp</strong></p></li>
</ul>
<p>The <strong>emission_loads.shp</strong> is the output of <a class="reference internal" href="#emission-loads"><span class="std std-ref">Emission Loads</span></a> while <strong>river_level.shp</strong> is the output of <a class="reference internal" href="Flow_Estimation.html#flow-estimation-tool"><span class="std std-ref">Flow Estimation</span></a>. In case the user already has
regionalized flow data, going through the <a class="reference internal" href="Flow_Estimation.html#flow-estimation"><span class="std std-ref">Flow Estimation</span></a> set of tools is not necessary. The important fields that should be in <strong>river_level.shp</strong> are:</p>
<ul class="simple">
<li><p>ID field: a column with a unique ID for each river section</p></li>
<li><p>Next field: a column with the ID of the downstream river section</p></li>
<li><p>Mean flow: mean flow value for the single river section [<span class="math notranslate nohighlight">\(m^3\!/s\)</span>]</p></li>
<li><p>Accumulated mean flow: sum of the upstream mean flow values [<span class="math notranslate nohighlight">\(m^3\!/s\)</span>]</p></li>
<li><p>Mean low flow: mean low flow value for the single river section [<span class="math notranslate nohighlight">\(m^3\!/s\)</span>]</p></li>
<li><p>Accumulated mean low flow: sum of the upstream mean low flow values [<span class="math notranslate nohighlight">\(m^3\!/s\)</span>]</p></li>
</ul>
<p>Regarding <strong>emission_loads.shp</strong>, the emission point should be at maximum 500 m from the closest river section, as stated before. If not, edit the location of the point.</p>
</section>
<section id="id8">
<h3>Workflow<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<ol class="arabic">
<li><p>Add the input data to the project by clicking on “Layer -&gt; Add Layer -&gt; Add Vector Layer”</p></li>
<li><p>Go in the Processing Toolbox and look for the <em>APRIORA</em> plugin. Click on <em>API emission</em> and open <em>6 - Accumulation</em></p></li>
<li><p>Choose <strong>emission_loads.shp</strong> as input for <em>API load</em></p></li>
<li><p>Select the fields containing the APIs to accumulate. This selection should include only columns containing load of APIs in kg/a.</p></li>
<li><p>Choose <strong>river_level.shp</strong> as input for <em>River network</em></p></li>
<li><div class="line-block">
<div class="line">Select the correct field of <strong>river_level.shp</strong> for <em>ID Field</em>, <em>Next Field</em>, <em>Mean Flow</em>, <em>Acc. Mean Flow</em>, <em>Mean Low Flow</em> and <em>Acc. Mean Low Flow</em>.
In case <strong>river_level.shp</strong> is the output of <a class="reference internal" href="Flow_Estimation.html#flow-estimation-tool"><span class="std std-ref">Flow Estimation</span></a>, here are the correct fields to select:</div>
</div>
<blockquote>
<div><ul class="simple">
<li><p><em>ID Field</em> -&gt; NET_ID</p></li>
<li><p><em>Next Field</em> -&gt; NET_TO</p></li>
<li><p><em>Mean Flow</em> -&gt; Mean_Flow</p></li>
<li><p><em>Acc. Mean Flow</em> -&gt; calc_Mean_</p></li>
<li><p><em>Mean Low Flow</em> -&gt; M_Low_Flow</p></li>
<li><p><em>Acc. Mean Low Flow</em> -&gt; calc_M_Low</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Click on <em>Run</em></p></li>
</ol>
<figure>
  <video width="700" height="370" controls>
    <source src="_static/accumulation_1.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <figcaption>Worflow of the <i>Accumulation</i> tool.</figcaption>
</figure><p>Output data:</p>
<ul class="simple">
<li><p><strong>river_accumulation.shp</strong></p></li>
</ul>
<p>The output is a line shapefile containing the updated geometry of the river network. Its attribute table contains, for each section, the emitted load, the
accumulated load and the resulting concentrations under both normal and low-flow condition for each API. <a class="reference internal" href="#accumulation-table"><span class="std std-numref">Table 3</span></a> shows only a part of the attribute table
for one substance and a few river sections.</p>
<span id="accumulation-table"></span><table class="docutils align-default" id="id29">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Example of attribute table of river_accumulation.shp.</span><a class="headerlink" href="#id29" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>NET_ID</p></th>
<th class="head"><p>NET_TO</p></th>
<th class="head"><p>Carb[kg/a]</p></th>
<th class="head"><p>acc_Carb <a class="footnote-reference brackets" href="#f1" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>conc_Carb <a class="footnote-reference brackets" href="#f2" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>conL_Carb <a class="footnote-reference brackets" href="#f3" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1005</p></td>
<td><p>1006</p></td>
<td><p>0</p></td>
<td><p>17.789</p></td>
<td><p>39.422</p></td>
<td><p>150.251</p></td>
</tr>
<tr class="row-odd"><td><p>1006</p></td>
<td><p>1007</p></td>
<td><p>0</p></td>
<td><p>17.789</p></td>
<td><p>39.265</p></td>
<td><p>149.398</p></td>
</tr>
<tr class="row-even"><td><p>1007</p></td>
<td><p>1008A</p></td>
<td><p>0</p></td>
<td><p>17.789</p></td>
<td><p>39.134</p></td>
<td><p>148.712</p></td>
</tr>
<tr class="row-odd"><td><p>1008A</p></td>
<td><p>1008B</p></td>
<td><p>0</p></td>
<td><p>17.789</p></td>
<td><p>38.615</p></td>
<td><p>148.277</p></td>
</tr>
<tr class="row-even"><td><p>1008B</p></td>
<td><p>1009</p></td>
<td><p>3.68</p></td>
<td><p>21.469</p></td>
<td><p>41.873</p></td>
<td><p>168.519</p></td>
</tr>
<tr class="row-odd"><td><p>1009</p></td>
<td><p>1010</p></td>
<td><p>0</p></td>
<td><p>21.469</p></td>
<td><p>41.671</p></td>
<td><p>167.611</p></td>
</tr>
<tr class="row-even"><td><p>1010</p></td>
<td><p>1011</p></td>
<td><p>0</p></td>
<td><p>21.469</p></td>
<td><p>41.368</p></td>
<td><p>166.652</p></td>
</tr>
<tr class="row-odd"><td><p>1011</p></td>
<td><p>1012</p></td>
<td><p>0</p></td>
<td><p>21.469</p></td>
<td><p>40.693</p></td>
<td><p>164.549</p></td>
</tr>
</tbody>
</table>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">1</a><span class="fn-bracket">]</span></span>
<p>Accumulation of Carbamazepine [<span class="math notranslate nohighlight">\(kg/a\)</span>]</p>
</aside>
<aside class="footnote brackets" id="f2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id10">1</a>,<a role="doc-backlink" href="#id15">2</a>)</span>
<p>Concentration of Carbamazepine in normal conditions [<span class="math notranslate nohighlight">\(ng/L\)</span>]</p>
</aside>
<aside class="footnote brackets" id="f3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id11">1</a>,<a role="doc-backlink" href="#id16">2</a>)</span>
<p>Concentration of Carbamazepine in low flow conditions [<span class="math notranslate nohighlight">\(ng/L\)</span>]</p>
</aside>
</aside>
</section>
</section>
<section id="risk-assessment">
<span id="id12"></span><h2>Risk Assessment<a class="headerlink" href="#risk-assessment" title="Link to this heading"></a></h2>
<p>This tool calculates the final risk for each river section. So far, only environmental risk assessment (ERA) is considered and can be calculated like
shown in <a class="reference internal" href="#equation-era-equation">(4)</a>.</p>
<div class="math notranslate nohighlight" id="equation-era-equation">
<span class="eqno">(4)<a class="headerlink" href="#equation-era-equation" title="Link to this equation"></a></span>\[ERA = \frac{PEC}{PNEC_{ERA}}\]</div>
<p>With:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(ERA\)</span> = Environmental Risk Assessment [-]</p></li>
<li><p><span class="math notranslate nohighlight">\(PEC\)</span> = Predicted Environmental Concentration [<span class="math notranslate nohighlight">\(ng/L\)</span>]</p></li>
<li><p><span class="math notranslate nohighlight">\(PNEC_{ERA}\)</span> = Predicted No Effect Concentration for ERA [<span class="math notranslate nohighlight">\(ng/L\)</span>]</p></li>
</ul>
<p>In addition to individual PNEC calculations, a cumulative Risk Quotient (RQ) coefficient is calculated to provide an overall assessment when
multiple APIs are selected. This single value summarizes the combined risk from all tested substances in each river section, giving the
user a quick, comprehensive view of the situation. The Risk Quotient is calculated using formula <a class="reference internal" href="#equation-logistic-function">(5)</a>.</p>
<div class="math notranslate nohighlight" id="equation-logistic-function">
<span class="eqno">(5)<a class="headerlink" href="#equation-logistic-function" title="Link to this equation"></a></span>\[RQ(x) = \frac{s}{1 + e^{-k(x-x_0)}}\]</div>
<p>With:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(RQ\)</span> = Risk Coefficient [-]</p></li>
<li><p><span class="math notranslate nohighlight">\(x\)</span> = sum of ERA values &gt; 1 [-]</p></li>
<li><p><span class="math notranslate nohighlight">\(s\)</span> = height parameter [-]</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span> = scale factor [-]</p></li>
<li><p><span class="math notranslate nohighlight">\(x0\)</span> = midpoint value [-]</p></li>
</ul>
<section id="id13">
<h3>Input data<a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<p>Only one input file is necessary:</p>
<ul class="simple">
<li><p><strong>river_accumulation.shp</strong></p></li>
</ul>
<p>This file is the output of the <a class="reference internal" href="#accumulation"><span class="std std-ref">Accumulation</span></a> tool. The key columns for this process are the ones containing concentration values. For each river section,
formula <a class="reference internal" href="#equation-era-equation">(4)</a> is applied and a PNEC value is calculated.</p>
</section>
<section id="id14">
<h3>Workflow<a class="headerlink" href="#id14" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>If not already in the project, add the input data by clicking on “Layer -&gt; Add Layer -&gt; Add Vector Layer”</p></li>
<li><p>Go in the Processing Toolbox and look for the <em>APRIORA</em> plugin. Click on <em>API emission</em> and open <em>7 - Risk Assessment</em></p></li>
<li><p>Choose <strong>river_accumulation.shp</strong> as input for <em>River network</em></p></li>
<li><p>Select the fields containing the concentration of APIs for the risk assessment. This selection should include only columns containing concentrations in ng/L.</p></li>
<li><p>If you added custom PNEC values from the <em>Consumption Selection</em> tool, flag the next box, otherwise leave it empty</p></li>
<li><p>Click on <em>Run</em></p></li>
</ol>
<figure>
  <video width="700" height="370" controls>
    <source src="_static/risk_assessment.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <figcaption>Worflow of the <i>Risk Assessment</i> tool.</figcaption>
</figure><p>Output data:</p>
<ul class="simple">
<li><p><strong>risk_assessment.shp</strong></p></li>
</ul>
<p>The output is a line shapefile containing the same geometry of <strong>river_accumulation.shp</strong>. The attribute table instead, has the same API concentration columns
plus ERA fields for both condition (mean flow and mean low flow) for each API selected. Finally, the last two columns represent RQ for the same two condition.
<a class="reference internal" href="#risk-assessment-table"><span class="std std-numref">Table 4</span></a> shows an example of a part of the attribute table.</p>
<span id="risk-assessment-table"></span><table class="docutils align-default" id="id30">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">Example of attribute table of risk_assessment.shp.</span><a class="headerlink" href="#id30" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
<col style="width: 16.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>conc_Carb <a class="footnote-reference brackets" href="#f2" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>conL_Carb <a class="footnote-reference brackets" href="#f3" id="id16" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>era_Carb <a class="footnote-reference brackets" href="#f4" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>eraL_Carb <a class="footnote-reference brackets" href="#f5" id="id18" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>cumul_RQ <a class="footnote-reference brackets" href="#f6" id="id19" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>cumul_RQ_L <a class="footnote-reference brackets" href="#f7" id="id20" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>89.309</p></td>
<td><p>459.004</p></td>
<td><p>0.035</p></td>
<td><p>0.183</p></td>
<td><p>0.999</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>77.771</p></td>
<td><p>399.703</p></td>
<td><p>0.031</p></td>
<td><p>0.159</p></td>
<td><p>0.999</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>36.737</p></td>
<td><p>188.808</p></td>
<td><p>0.015</p></td>
<td><p>0.075</p></td>
<td><p>0.007</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>5.778</p></td>
<td><p>29.699</p></td>
<td><p>0.002</p></td>
<td><p>0.012</p></td>
<td><p>0.007</p></td>
<td><p>0.007</p></td>
</tr>
<tr class="row-even"><td><p>0.789</p></td>
<td><p>4.056</p></td>
<td><p>0.0003</p></td>
<td><p>0.002</p></td>
<td><p>0.007</p></td>
<td><p>0.007</p></td>
</tr>
</tbody>
</table>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">4</a><span class="fn-bracket">]</span></span>
<p>Environmental Risk Assessment of Carbamazepine in normal conditions [-]</p>
</aside>
<aside class="footnote brackets" id="f5" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id18">5</a><span class="fn-bracket">]</span></span>
<p>Environmental Risk Assessment of Carbamazepine in low flow conditions [-]</p>
</aside>
<aside class="footnote brackets" id="f6" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id19">6</a><span class="fn-bracket">]</span></span>
<p>Risk Quotient in normal conditions [-]</p>
</aside>
<aside class="footnote brackets" id="f7" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id20">7</a><span class="fn-bracket">]</span></span>
<p>Risk Quotient in low flow conditions [-]</p>
</aside>
</aside>
<p>The style of <strong>risk_assessment.shp</strong> is based on the value of RQ and it is possible to change it by going on “Layer Properties” -&gt; “Symbology”.</p>
</section>
</section>
<section id="dummy-data">
<span id="id21"></span><h2>Dummy data<a class="headerlink" href="#dummy-data" title="Link to this heading"></a></h2>
<p>You can find the data used for making the video-tutorial at this <a class="reference external" href="https://unibox.uni-rostock.de/getlink/fiDTUCNDi2eJj6pneAW4b7/4_Fourth%20TTT%20session%20%2830.09.25%29">link</a>.
Feel free to download them and try to replicate the workflow.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Flow_Estimation.html" class="btn btn-neutral float-left" title="Flow Estimation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Cristiano Guidi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>