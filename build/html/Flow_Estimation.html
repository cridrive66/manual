

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flow Estimation &mdash; APRIORA plugin manual  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=1f9ce7ab" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Emission" href="API_emission.html" />
    <link rel="prev" title="Installation for Windows" href="Installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            APRIORA plugin manual
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation for Windows</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Flow Estimation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fix-river-network">Fix River Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-data">Input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workflow">Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#contributing-area-of-gauging-station">Contributing Area of Gauging Station</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calculate-geofactors">Calculate Geofactors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Input data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#flow-estimation-tool">Flow Estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#random-forest-regressor">Random Forest Regressor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API_emission.html">API Emission</a></li>
<li class="toctree-l1"><a class="reference internal" href="Troubleshooting.html">Troubleshooting</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">APRIORA plugin manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Flow Estimation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Flow_Estimation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="flow-estimation">
<span id="id1"></span><h1>Flow Estimation<a class="headerlink" href="#flow-estimation" title="Link to this heading"></a></h1>
<p>The <em>Flow Estimation</em> provides an estimation of yearly mean flow and yearly mean low fow for each subcatchment or
river section within a specified catchment area. This estimation is made by <strong>Random Forest</strong> (<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">source</a>), which
uses the catchment’s geographical characteristics as predictors and water flow data collected from gauging stations
to calibrate and validate the approach.</p>
<p>This group of tools is divided in 4 different processes:</p>
<ul class="simple">
<li><p>Fix River Network</p></li>
<li><p>Contributing Area</p></li>
<li><p>Calculate Geofactors</p></li>
<li><p>Flow Estimation</p></li>
</ul>
<p><strong>insert plugin scheme</strong></p>
<section id="fix-river-network">
<h2>Fix River Network<a class="headerlink" href="#fix-river-network" title="Link to this heading"></a></h2>
<p>Understanding the flow direction (where the water is going and which other river section it contributes to) is a critical aspect of the river network.
This information is very important for calculating the flow of each river section and determining accumulated values.
Also, in many cases the intersection between the river network and the subcatchments is not perfectly aligned. This misalignment can cause issue in later
steps of the plugin, so better fix the input beforehand!</p>
<p>This algorithm was developed from the plugin <em>WaterNetAnalyzer</em> by Jannik Schilling (<a class="reference external" href="https://github.com/Jannik-Schilling/WaterNetAnalyzer">source</a>).</p>
<p>NET_ID and NET_TO are very important because they explain the relationship of the river network.</p>
<p>It can happen that there is a misalignment between the river sections and the subcatchments. Here we fix it.
We fix it because otherwise the model struggle to understand where the water is flowing and it can cause errors or over/under estimation during the flow model.</p>
<p><strong>insert picture of river and subcatchments misalignment</strong></p>
<p>If the misalignment is greater than 10 cm, the plugin will not fix it and it is necessary to manually adjust the input file. Check the <a class="reference internal" href="Troubleshooting.html#troubleshooting"><span class="std std-ref">Troubleshooting</span></a> section
for more information about it.</p>
<section id="input-data">
<h3>Input data<a class="headerlink" href="#input-data" title="Link to this heading"></a></h3>
<p>Two input data are necessary for this tool:</p>
<ul class="simple">
<li><p><strong>subcatchments.shp</strong></p></li>
<li><p><strong>river_network.shp</strong></p></li>
</ul>
<p>The <strong>subcatchments.shp</strong> is a polygon shapefile that describes the division of the catchment in water basins.
The <strong>river_network.shp</strong> is a line shapefile that represents the river network within the catchment. It is important that all the sections are connected
to each others without gaps. It is also required a precise alignment between the river network and the subcatchments (like already explained above).
For this tool, their attributes are not important, more important is their geometry.</p>
<p><strong>figure with example of input data</strong></p>
</section>
<section id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Add all the input data to the project by clicking on “Layer –&gt; Add Layer –&gt; Add Vector Layer”</p></li>
<li><p>Go in the Processing Toolbox and look for the <em>APRIORA</em> plugin. Click on <em>Flow estimation</em> and open <em>1 - Fix River Network</em></p></li>
<li><p>Choose <strong>subcatchments.shp</strong> as input for <em>Catchment areas</em></p></li>
<li><p>Choose <strong>river_network.shp</strong> as input for <em>River network</em></p></li>
<li><p>Click on the three dots and click on the outlet point of the river network. The selected point does not have to be exactly on the outlet, just approximately there.</p></li>
<li><p>Click on <em>Run</em></p></li>
</ol>
<p><strong>insert video tutorial</strong></p>
<img alt="_images/Fix_river_network_1.png" src="_images/Fix_river_network_1.png" />
<p>Output data:</p>
<ul class="simple">
<li><p><strong>fixed_river_network.shp</strong></p></li>
</ul>
<p>Two new columns have been added to the attribute table: NET_ID and NET_TO. These columns represent respectively the river network ID of each specific section and the river network ID of
the downstream river section. Before we continue, it is important to check if the new colums are populated correctly for all river sections. If any value under NET_TO is marked as
<em>unconnected</em>, it might be due to the fact that the river sections are not connected with each others. Check the geometry of the <em>unconnected</em> river sections, manually adjust them and re-run the
tool until there are no <em>unconnected</em> values in the NET_TO column. Important: apply the changes to the original file <strong>river_network.shp</strong> and not to <strong>fixed_river_network.shp</strong>.</p>
</section>
</section>
<section id="contributing-area-of-gauging-station">
<h2>Contributing Area of Gauging Station<a class="headerlink" href="#contributing-area-of-gauging-station" title="Link to this heading"></a></h2>
<p>Every gauging station measures the flow of a river. However, to understand the flow dynamics, we need to determine the area contributing to each gauging station.
This tool allows us to calculate the area upstream each gauging station, which we will use in a later step of the plugin. In case we have more than one gauging
station within the catchment, the tool will generate a single output file where the contributing areas overlap.</p>
<section id="id3">
<h3>Input data<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>subcatchments.shp</strong></p></li>
<li><p><strong>fixed_river_network.shp</strong> (from <em>Fix River Network</em>)</p></li>
<li><p><strong>gauging_stations.shp</strong></p></li>
</ul>
<p>The first two input data were already discussed previously, so let’s talk about the <strong>gauging_stations.shp</strong>. It is a point shapefile representing the
gauging stations within the catchment. Beside the basic information (like ID, coordinates, etc.), it should contain two columns related to <em>Mean Flow</em>
and <em>Mean Low Flow</em> calculated at the gauging station. The two average values should be calculated over a certain time series (e.g., 1991 - 2020).
In Table 1, you can see an example of the <strong>gauging_stations.shp</strong>.</p>
<table class="docutils align-default" id="id8">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Gauging stations example.</span><a class="headerlink" href="#id8" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 26.3%" />
<col style="width: 31.6%" />
<col style="width: 21.1%" />
<col style="width: 21.1%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>gml_id</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Mean Flow</p></th>
<th class="head"><p>Mean Low Flow</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ID_1974292</p></td>
<td><p>Rostock-Geinitzbrücke</p></td>
<td><p>18,13</p></td>
<td><p>4,39</p></td>
</tr>
<tr class="row-odd"><td><p>ID_1974292</p></td>
<td><p>Rostock-Geinitzbrücke</p></td>
<td><p>18,13</p></td>
<td><p>4,39</p></td>
</tr>
<tr class="row-even"><td><p>ID_1974292</p></td>
<td><p>Rostock-Geinitzbrücke</p></td>
<td><p>18,13</p></td>
<td><p>4,39</p></td>
</tr>
<tr class="row-odd"><td><p>ID_1974292</p></td>
<td><p>Rostock-Geinitzbrücke</p></td>
<td><p>18,13</p></td>
<td><p>4,39</p></td>
</tr>
<tr class="row-even"><td><p>ID_1974292</p></td>
<td><p>Rostock-Geinitzbrücke</p></td>
<td><p>18,13</p></td>
<td><p>4,39</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id4">
<h3>Workflow<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Add all the input data to the project by clicking on “Layer –&gt; Add Layer –&gt; Add Vector Layer”</p></li>
<li><p>Go in the Processing Toolbox and look for the <em>APRIORA</em> plugin. Click on <em>Flow estimation</em> and open <em>2 - Contributing Area of Gauging Station</em></p></li>
<li><p>Choose <strong>subcatchments.shp</strong> as input for <em>Catchment areas</em></p></li>
<li><p>Choose <strong>fixed_river_network.shp</strong> as input for <em>River network</em></p></li>
<li><p>Choose <strong>gauging_stations.shp</strong> as input for <em>Gauging stations</em></p></li>
<li><p>Select the <em>Mean Flow</em> field and <em>Mean Low Flow</em> field from <strong>gauging_stations.shp</strong></p></li>
<li><p>Click on <em>Run</em></p></li>
</ol>
<p><strong>insert video tutorial</strong></p>
<p>Output data:</p>
<ul class="simple">
<li><p><strong>gauged_subcatchments.shp</strong></p></li>
<li><p><strong>ungauged_subcatchments.shp</strong></p></li>
</ul>
<p>Open the attribute table of <strong>gauged_subcatchments.shp</strong> and check its features. Each feature represents the contributing area for a gauging station. If
there is more than one gauging station, you will notice that the contributing areas are overlapping. If you want to highlight a specific feature, right-click
on it and select <em>Flash Feature</em>. Important to notice: there are two extra fields called <em>Mean_Flow</em> and <em>M_L_Flow</em> that come directly from <strong>gauging_stations.shp</strong>.</p>
<p>Now, open the attribute table of <strong>ungauged_subcatchments.shp</strong>. You will find a new column called <em>id_catch</em>. This field assigns a unique code to each subcatchment
and river section, making it easier to link subcatchments with their corresponding river section in later steps.</p>
</section>
</section>
<section id="calculate-geofactors">
<h2>Calculate Geofactors<a class="headerlink" href="#calculate-geofactors" title="Link to this heading"></a></h2>
<p>The flow estimation model uses a machine learning approach to estimate the water flow. The main core of this ML-based regionalization is to establish a predictive
relationship between model parameters and subcatchment geofactors. This relationship is used to predict the morel parameters of ungauged subcatchments and estimate
their water flow. The geofactors are physical and hydrological chatacteristics of subcatchments, such as area, slope or land use, that influence water flow.
In this tool we use certain input data to calculate the geofactors related to each subcatchment.</p>
<section id="id5">
<h3>Input data<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>gauged_subcatchments.shp</strong> (from <em>Contributing Area of Gauging Station</em>)</p></li>
<li><p><strong>ungauged_subcatchments.shp</strong> (from <em>Contributing Area of Gauging Station</em>)</p></li>
<li><p><strong>fixed_river_network.shp</strong> (from <em>Fix River Network</em>)</p></li>
<li><p><strong>DEM.tif</strong></p></li>
<li><p><strong>water_area.shp</strong></p></li>
<li><p><strong>forest_area.shp</strong></p></li>
<li><p><strong>settlement_area.shp</strong></p></li>
<li><p><strong>precipitation data</strong></p></li>
</ul>
<p>The first three input data were already discussed previously. <strong>DEM.tif</strong>, is a digital elevation model raster file. <strong>water_area.shp</strong>, <strong>forest_area.shp</strong>
and <strong>settlement_area.shp</strong> are polygon shapefile representing respectively water bodies (lakes), forest and settlement area. Last is <strong>precipitation data</strong>
that can be stored as several .nc files in a folder or as a unique raster file. The <strong>precipitation data</strong> should cover a time series equal to the time series
selected for the flow at the gauging stations.</p>
<p><strong>insert a table of where we can find the data</strong></p>
</section>
<section id="id6">
<h3>Workflow<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
</section>
</section>
<section id="flow-estimation-tool">
<span id="id7"></span><h2>Flow Estimation<a class="headerlink" href="#flow-estimation-tool" title="Link to this heading"></a></h2>
<p>This is the last part of the model where we estimate the flow.</p>
<section id="random-forest-regressor">
<h3>Random Forest Regressor<a class="headerlink" href="#random-forest-regressor" title="Link to this heading"></a></h3>
<p>This is the model used for estimating the flow.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Installation.html" class="btn btn-neutral float-left" title="Installation for Windows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="API_emission.html" class="btn btn-neutral float-right" title="API Emission" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Cristiano Guidi.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>